var externalDefine = window.define;var externalRequire = window.require;window.define = undefined;window.require = undefined;
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).BabylonAR=e()}}(function(){return function i(o,s,c){function u(t,e){if(!s[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[t]={exports:{}};o[t][0].call(a.exports,function(e){return u(o[t][1][e]||e)},a,a.exports,i,o,s,c)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(n,e,a){(function(r){(function(){"use strict";var e=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((c=c.apply(e,o||[])).next())})},c=this&&this.__generator||function(r,n){var a,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(a,"__esModule",{value:!0}),a.ArUcoMetaMarkerObjectTracker=void 0;var u="undefined"!=typeof window?window.BABYLON:void 0!==r?r.BABYLON:null,o=n("./arUcoMetaMarkerTracker"),l=n("../shared/trackedNode"),t=(s.prototype.addTrackableObjectAsync=function(n,a,i,o,s){return e(this,void 0,void 0,function(){var t,r;return c(this,function(e){switch(e.label){case 0:return[4,this._tracker.addMarker(n,a,i,o,s)];case 1:return t=e.sent(),(r=new l.TrackedNode(n+"_"+a+"_"+i+"_"+o,this._scene,!0)).rotationQuaternion=u.Quaternion.Identity(),[2,this._trackedNodes[t.id]=r]}})})},s.prototype.startTracking=function(){var r=this,n=!1;this._runTrackingObserver=this._scene.onAfterRenderObservable.add(function(){n||(n=!0,r._tracker.updateAsync().then(function(){for(var e in r._trackedNodes){var t=r._tracker.markers[e];r._trackedNodes[e].setTracking(t.position,t.rotation,.98<t.confidence)}n=!1}))})},s.prototype.stopTracking=function(){this._scene.onAfterRenderObservable.remove(this._runTrackingObserver),this._runTrackingObserver=null},s.CreateAsync=function(n,a,i){return void 0===i&&(i=1),e(this,void 0,void 0,function(){var t,r;return c(this,function(e){switch(e.label){case 0:return t=new s(a),r=t,[4,o.ArUcoMetaMarkerTracker.CreateAsync(n)];case 1:return r._tracker=e.sent(),[4,t.setCalibrationAsync(n,i)];case 2:return e.sent(),[2,t]}})})},s.prototype.setCalibrationAsync=function(e,t){return this._tracker.setCalibrationAsync(Math.round(t*e.getSize().width),Math.round(t*e.getSize().height))},s);function s(e){this._runTrackingObserver=null,this._trackedNodes={},this._scene=e}a.ArUcoMetaMarkerObjectTracker=t}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../shared/trackedNode":13,"./arUcoMetaMarkerTracker":2}],2:[function(u,e,l){(function(o){(function(){"use strict";var e=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((c=c.apply(e,o||[])).next())})},i=this&&this.__generator||function(r,n){var a,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(l,"__esModule",{value:!0}),l.ArUcoMetaMarkerTracker=l.ArUcoMetaMarker=void 0;var t="undefined"!=typeof window?window.BABYLON:void 0!==o?o.BABYLON:null,s=u("../shared/dedicatedWorker"),n=u("../shared/constants"),c=function(e){this.id=e,this.confidence=0,this.position=t.Vector3.Zero(),this.rotation=t.Quaternion.Identity()};l.ArUcoMetaMarker=c;var r=(a.onInitialized=function(){Module._reset(),postMessage({initialized:!0})},a.onMessage=function(e){var t=e.data;if(t.reset)Module._reset(),postMessage({reset:!0});else if(t.calibrate)Module._set_calibration_from_frame_size(t.width,t.height),postMessage({calibrated:!0});else if(t.addMarker){var r=Module._add_marker(t.ul,t.ur,t.ll,t.lr,t.width);postMessage({added:!0,id:r})}else if(t.track){var n=Module._malloc(t.imageData.length*t.imageData.BYTES_PER_ELEMENT);Module.HEAP8.set(t.imageData,n);var u=[];Module._update_marker_tracking=function(e,t,r,n,a,i,o,s,c){u=u.concat([e,t,r,n,a,i,o,s,c])},Module._process_image(t.width,t.height,n),Module._update_marker_tracking=function(){},Module._free(n),postMessage({markers:u})}},a.CreateAsync=function(e){return new Promise(function(t){var r=new a(e);r._worker=s.DedicatedWorker.createFromLocation(n.ARUCO_META_MARKER_TRACKER_URL,a.onInitialized,a.onMessage),r._worker.onmessage=function(e){r._worker.onmessage=s.DedicatedWorker.unexpectedMessageHandler,t(r)}})},a.prototype.setCalibrationAsync=function(e,t){var n=this,r=new Promise(function(t,r){n._worker.onmessage=function(e){n._worker.onmessage=s.DedicatedWorker.unexpectedMessageHandler,e.data.calibrated?t():r(e.data)}});return this._worker.postMessage({calibrate:!0,width:e,height:t}),r},a.prototype.addMarker=function(e,t,r,n,a){var i=this,o=new Promise(function(r,n){i._worker.onmessage=function(e){if(i._worker.onmessage=s.DedicatedWorker.unexpectedMessageHandler,e.data.added){var t=e.data.id;i.markers[t]=new c(t),r(i.markers[t])}else n(e.data)}});return this._worker.postMessage({addMarker:!0,ul:e,ur:t,ll:r,lr:n,width:a}),o},a.prototype.updateAsync=function(){return e(this,void 0,void 0,function(){var t,r,n,a,o=this;return i(this,function(e){switch(e.label){case 0:return t=new Promise(function(a,i){o._worker.onmessage=function(e){if(o._worker.onmessage=s.DedicatedWorker.unexpectedMessageHandler,e.data.markers){for(var t=e.data.markers,r=0;r<t.length;r+=9){var n=o.markers[t[r]];n.confidence=t[r+1],n.position.set(t[r+2],t[r+3],t[r+4]),n.rotation.set(t[r+5],t[r+6],t[r+7],t[r+8])}a()}else i(e.data)}}),n=(r=this._worker).postMessage,a={track:!0,width:this._videoTexture.getSize().width,height:this._videoTexture.getSize().height},[4,this._videoTexture.readPixels()];case 1:return n.apply(r,[(a.imageData=e.sent(),a)]),[4,t];case 2:return e.sent(),[2]}})})},a);function a(e){this.markers={},this._videoTexture=e}l.ArUcoMetaMarkerTracker=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../shared/constants":10,"../shared/dedicatedWorker":11}],3:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),a(e("./arUcoMetaMarkerObjectTracker/arUcoMetaMarkerObjectTracker"),r),a(e("./core/index"),r),a(e("./exampleWorker/exampleWorker"),r),a(e("./exampleObjectTracker/exampleObjectTracker"),r),a(e("./imageTemplateTracker/imageTemplateTracker"),r)},{"./arUcoMetaMarkerObjectTracker/arUcoMetaMarkerObjectTracker":1,"./core/index":4,"./exampleObjectTracker/exampleObjectTracker":7,"./exampleWorker/exampleWorker":8,"./imageTemplateTracker/imageTemplateTracker":9}],4:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),a(e("./objectTrackerCamera"),r)},{"./objectTrackerCamera":5}],5:[function(e,t,o){(function(i){(function(){"use strict";var n,e=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),t=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((c=c.apply(e,o||[])).next())})},u=this&&this.__generator||function(r,n){var a,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ObjectTrackerCamera=void 0;var a,l="undefined"!=typeof window?window.BABYLON:void 0!==i?i.BABYLON:null,r=(a=l.Camera,e(d,a),d.CreateAsync=function(s,c){return t(this,void 0,void 0,function(){var t,r,n,a,i,o;return u(this,function(e){switch(e.label){case 0:return c.clearColor.set(0,0,0,1),(t=new d(s,c)).fovMode=l.Camera.FOVMODE_VERTICAL_FIXED,t.fov=l.Tools.ToRadians(40),r={maxWidth:640,maxHeight:480,minWidth:640,minHeight:480,deviceId:""},[4,navigator.mediaDevices.enumerateDevices()];case 1:return e.sent().forEach(function(e){"videoinput"===e.kind&&(r.deviceId=e.deviceId)}),n=t,[4,l.VideoTexture.CreateFromWebCamAsync(c,r)];case 2:return n.videoTexture=e.sent(),t._layer.texture=t.videoTexture,t._layer.texture.wrapU=l.Texture.CLAMP_ADDRESSMODE,t._layer.texture.wrapV=l.Texture.WRAP_ADDRESSMODE,t._layer.texture.vScale=-1,a=t._layer.texture.getSize(),i=a.width/a.height,t._beforeRenderObserver=t._layer.onBeforeRenderObservable.add(function(){(o=c.getEngine().getScreenAspectRatio()/i)<1?(t.viewport.x=0,t.viewport.width=1,t._layer.texture.uScale=o,t._layer.texture.uOffset=(1-o)/2):(t.viewport.width=1/o,t.viewport.x=(1-t.viewport.width)/2,t._layer.texture.uScale=1,t._layer.texture.uOffset=0)}),[2,t]}})})},d.prototype.dispose=function(){this._layer.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._layer.dispose(),a.prototype.dispose.call(this)},d);function d(e,t){var r=a.call(this,e,l.Vector3.Zero(),t)||this;return r._layer=new l.Layer(e+"_backgroundLayer",null,t),r}o.ObjectTrackerCamera=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((c=c.apply(e,o||[])).next())})},s=this&&this.__generator||function(r,n){var a,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.ExampleMarkerTracker=void 0;var c=e("../shared/dedicatedWorker"),a=e("../shared/constants"),i=(o.onInitialized=function(){Module._reset(),postMessage({initialized:!0})},o.onMessage=function(e){var t=e.data;if(t.reset)Module._reset(),postMessage({reset:!0});else if(t.calibrate)Module._set_calibration_from_frame_size(t.width,t.height),postMessage({calibrated:!0});else if(t.track){var r=Module._malloc(t.imageData.length*t.imageData.BYTES_PER_ELEMENT);Module.HEAP8.set(t.imageData,r);var n=Module._process_image(t.width,t.height,r,1);Module._free(r);for(var a=[],i=0,o=0,s=0,c=0,u=0,l=0,d=0,_=0,f=0;f<n;f++){var h=Module._get_tracked_marker(f);i=0,o=Module.getValue(h+i,"i32"),i+=12,s=Module.getValue(h+i,"double"),i+=8,c=Module.getValue(h+i,"double"),i+=8,u=Module.getValue(h+i,"double"),i+=8,l=Module.getValue(h+i,"double"),i+=8,d=Module.getValue(h+i,"double"),i+=8,_=Module.getValue(h+i,"double"),a.push({id:o,tx:s,ty:c,tz:u,rx:l,ry:d,rz:_})}postMessage({markers:a})}},o.CreateAsync=function(){return new Promise(function(t){var r=new o;r._worker=c.DedicatedWorker.createFromLocation(a.EXAMPLE_MODULE_URL,o.onInitialized,o.onMessage),r._worker.onmessage=function(e){r._worker.onmessage=c.DedicatedWorker.unexpectedMessageHandler,t(r)}})},o.prototype.setCalibrationAsync=function(e,t){var n=this,r=new Promise(function(t,r){n._worker.onmessage=function(e){n._worker.onmessage=c.DedicatedWorker.unexpectedMessageHandler,e.data.calibrated?t():r(e.data)}});return this._worker.postMessage({calibrate:!0,width:e,height:t}),r},o.prototype.findMarkersInImageAsync=function(o){return n(this,void 0,void 0,function(){var t,r,n,a,i=this;return s(this,function(e){switch(e.label){case 0:return t=new Promise(function(t,r){i._worker.onmessage=function(e){i._worker.onmessage=c.DedicatedWorker.unexpectedMessageHandler,e.data.markers?t(e.data.markers):r(e.data)}}),n=(r=this._worker).postMessage,a={track:!0,width:o.getSize().width,height:o.getSize().height},[4,o.readPixels()];case 1:return n.apply(r,[(a.imageData=e.sent(),a)]),[4,t];case 2:return[2,e.sent()]}})})},o);function o(){}r.ExampleMarkerTracker=i},{"../shared/constants":10,"../shared/dedicatedWorker":11}],7:[function(s,e,c){(function(t){(function(){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ExampleObjectTracker=void 0;var i="undefined"!=typeof window?window.BABYLON:void 0!==t?t.BABYLON:null,n=s("./exampleMarkerTracker"),r=s("../shared/filteredVector3"),o=s("../shared/trackedNode"),e=(a.prototype.addTrackableObject=function(e,t,r,n){var a=[e,t,r,n].toString();return this._trackableObjects.add(a,new o.TrackedNode(a.toString(),this._scene)),this._trackableObjects.get(a)},a.prototype.processResults=function(n){var a=this;this._trackableObjects.forEach(function(e,t){var r=e.split(",");a.__ulId=parseInt(r[0]),a.__urId=parseInt(r[1]),a.__llId=parseInt(r[2]),a.__lrId=parseInt(r[3]),a.__posEstimate.set(0,0,0),a.__posEstimateCount=0,a.__rightEstimate.set(0,0,0),a.__rightEstimateCount=0,a.__forwardEstimate.set(0,0,0),a.__forwardEstimateCount=0,n[a.__llId]&&(n[a.__urId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__llId].position),a.__scratchVec.addInPlace(n[a.__urId].position),a.__scratchVec.scaleInPlace(.5),a.__posEstimate.addInPlace(a.__scratchVec),a.__posEstimateCount+=1),n[a.__lrId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__lrId].position),a.__scratchVec.subtractInPlace(n[a.__llId].position),a.__scratchVec.normalize(),a.__rightEstimate.addInPlace(a.__scratchVec),a.__rightEstimateCount+=1),n[a.__ulId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__ulId].position),a.__scratchVec.subtractInPlace(n[a.__llId].position),a.__scratchVec.normalize(),a.__forwardEstimate.addInPlace(a.__scratchVec),a.__forwardEstimateCount+=1)),n[a.__urId]&&(n[a.__lrId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__urId].position),a.__scratchVec.subtractInPlace(n[a.__lrId].position),a.__scratchVec.normalize(),a.__forwardEstimate.addInPlace(a.__scratchVec),a.__forwardEstimateCount+=1),n[a.__ulId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__urId].position),a.__scratchVec.subtractInPlace(n[a.__ulId].position),a.__scratchVec.normalize(),a.__rightEstimate.addInPlace(a.__scratchVec),a.__rightEstimateCount+=1)),n[a.__lrId]&&n[a.__ulId]&&(a.__scratchVec.set(0,0,0),a.__scratchVec.addInPlace(n[a.__lrId].position),a.__scratchVec.addInPlace(n[a.__ulId].position),a.__scratchVec.scaleInPlace(.5),a.__posEstimate.addInPlace(a.__scratchVec),a.__posEstimateCount+=1),0<a.__posEstimateCount*a.__rightEstimateCount*a.__forwardEstimateCount?(a.__posEstimate.scaleInPlace(1/a.__posEstimateCount),a.__rightEstimate.scaleInPlace(1/a.__rightEstimateCount),a.__forwardEstimate.scaleInPlace(1/a.__forwardEstimateCount),a.__filteredPos.addSample(a.__posEstimate),a.__filteredRight.addSample(a.__rightEstimate),a.__filteredForward.addSample(a.__forwardEstimate),a.__targetPosition.copyFrom(a.__filteredPos),i.Quaternion.RotationQuaternionFromAxisToRef(a.__filteredRight,i.Vector3.Cross(a.__filteredForward,a.__filteredRight),a.__filteredForward,a.__targetRotation),t.setTracking(a.__targetPosition,a.__targetRotation,!0)):t.setTracking(a.__targetPosition,a.__targetRotation,!1)})},a.prototype.setCalibrationAsync=function(e){return void 0===e&&(e=1),this._tracker.setCalibrationAsync(Math.round(e*this._videoTexture.getSize().width),Math.round(e*this._videoTexture.getSize().height))},a.getQuaternionFromRodrigues=function(e,t,r){var n=new i.Vector3(-e,t,-r),a=n.length();return n.scaleInPlace(1/a),0!==a?i.Quaternion.RotationAxis(n,a):null},a.prototype.startTracking=function(){var r=this,n=!1;this._runTrackingObserver=this._scene.onAfterRenderObservable.add(function(){n||(n=!0,r._tracker.findMarkersInImageAsync(r._videoTexture).then(function(e){if(e){var t={};e.forEach(function(e){t[e.id]={position:new i.Vector3(e.tx,-e.ty,e.tz),rotation:a.getQuaternionFromRodrigues(e.rx,e.ry,e.rz)}}),r.processResults(t)}n=!1}))})},a.prototype.stopTracking=function(){this._scene.onAfterRenderObservable.remove(this._runTrackingObserver),this._runTrackingObserver=null},a.CreateAsync=function(e,t){var r=new a(e,t);return n.ExampleMarkerTracker.CreateAsync().then(function(e){return r._tracker=e,r.setCalibrationAsync()}).then(function(){return r})},a);function a(e,t){this._runTrackingObserver=null,this._trackableObjects=new i.StringDictionary,this.__posEstimate=i.Vector3.Zero(),this.__posEstimateCount=0,this.__rightEstimate=i.Vector3.Zero(),this.__rightEstimateCount=0,this.__forwardEstimate=i.Vector3.Zero(),this.__forwardEstimateCount=0,this.__scratchVec=i.Vector3.Zero(),this.__filteredPos=new r.FilteredVector3(0,0,0),this.__filteredRight=new r.FilteredVector3(0,0,0),this.__filteredForward=new r.FilteredVector3(0,0,0),this.__targetPosition=i.Vector3.Zero(),this.__targetRotation=i.Quaternion.Identity(),this.__ulId=-1,this.__urId=-1,this.__llId=-1,this.__lrId=-1,this._scene=t,this._videoTexture=e}c.ExampleObjectTracker=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../shared/filteredVector3":12,"../shared/trackedNode":13,"./exampleMarkerTracker":6}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ExampleWorker=void 0;var n=e("../shared/dedicatedWorker"),a=e("../shared/constants"),i=(o.onInitialized=function(){postMessage({message:"Got a module!"})},o.onMessage=function(e){var t=e.data;t.wentToWorker=!0,postMessage(t)},o.CreateAsync=function(){return new Promise(function(t){var r=new o;r._worker=n.DedicatedWorker.createFromLocation(a.EXAMPLE_MODULE_URL,o.onInitialized,o.onMessage),r._worker.onmessage=function(e){r._worker.onmessage=n.DedicatedWorker.unexpectedMessageHandler,t(r)}})},o.prototype.sendMessageAsync=function(e){var r=this,t=new Promise(function(t){r._worker.onmessage=function(e){t(e.data),r._worker.onmessage=n.DedicatedWorker.unexpectedMessageHandler}});return this._worker.postMessage(e),t},o);function o(){}r.ExampleWorker=i},{"../shared/constants":10,"../shared/dedicatedWorker":11}],9:[function(r,e,i){(function(t){(function(){"use strict";var c=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((c=c.apply(e,o||[])).next())})},u=this&&this.__generator||function(r,n){var a,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(i,"__esModule",{value:!0}),i.ImageTemplateTracker=void 0;var l="undefined"!=typeof window?window.BABYLON:void 0!==t?t.BABYLON:null,d=r("../shared/dedicatedWorker"),n=r("../shared/constants"),e=(a.onInitialized=function(){postMessage({initialized:!0})},a.onMessage=function(e){var t=e.data;if(t.initialize){var r=Module._malloc(t.imageData.length*t.imageData.BYTES_PER_ELEMENT);Module.HEAP8.set(t.imageData,r),Module._initialize(t.width,t.height,r,t.x,t.y),Module._free(r),postMessage({initialized:!0})}else if(t.uninitialize)Module._uninitialize(),postMessage({uninitialized:!0});else if(t.track){r=Module._malloc(t.imageData.length*t.imageData.BYTES_PER_ELEMENT),Module.HEAP8.set(t.imageData,r);var n=!1,a=-1,i=-1;Module._update_template_position=function(e,t){n=!0,a=e,i=t},Module._track_template_in_image(t.width,t.height,r),Module._update_template_position=function(){},Module._free(r),postMessage({tracked:n,x:a,y:i})}},a.CreateAsync=function(e){return new Promise(function(t){var r=new a(e);r._worker=d.DedicatedWorker.createFromLocation(n.IMAGE_TEMPLATE_TRACKER_URL,a.onInitialized,a.onMessage),r._worker.onmessage=function(e){r._worker.onmessage=d.DedicatedWorker.unexpectedMessageHandler,t(r)}})},a.prototype.startTracking=function(i,o){var e=this;this._tracking=!0,this._trackingLoop=new Promise(function(s){return c(e,void 0,void 0,function(){var t,r,n,a=this;return u(this,function(e){switch(e.label){case 0:return this._worker.onmessage=function(){function t(i){return c(a,void 0,void 0,function(){var t,r,n,a=this;return u(this,function(e){switch(e.label){case 0:return i.tracked?(o.set(i.x,i.y),this.onTrackingUpdatedObservable.notifyObservers(o)):this.onTrackingUpdatedObservable.notifyObservers(null),this._tracking?(r=(t=this._worker).postMessage,n={track:!0,width:this._videoTexture.getSize().width,height:this._videoTexture.getSize().height},[4,this._videoTexture.readPixels()]):[3,2];case 1:return r.apply(t,[(n.imageData=e.sent(),n)]),[3,3];case 2:this._worker.onmessage=function(){a._worker.onmessage=d.DedicatedWorker.unexpectedMessageHandler,s()},this._worker.postMessage({uninitialize:!0}),e.label=3;case 3:return[2]}})})}var o=l.Vector2.Zero();a._worker.onmessage=function(e){t(e.data)},t({tracked:!1,x:-1,y:-1})},r=(t=this._worker).postMessage,n={initialize:!0,x:i,y:o,width:this._videoTexture.getSize().width,height:this._videoTexture.getSize().height},[4,this._videoTexture.readPixels()];case 1:return r.apply(t,[(n.imageData=e.sent(),n)]),[2]}})})})},a.prototype.stopTrackingAsync=function(){return this._tracking=!1,this._trackingLoop},a);function a(e){this._videoTexture=e,this.onTrackingUpdatedObservable=new l.Observable}i.ImageTemplateTracker=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../shared/constants":10,"../shared/dedicatedWorker":11}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IMAGE_TEMPLATE_TRACKER_URL=r.ARUCO_META_MARKER_TRACKER_URL=r.EXAMPLE_MODULE_URL=void 0;var n="https://ar.babylonjs.com/wasm/";r.EXAMPLE_MODULE_URL=n+"webpiled-aruco-ar.js",r.ARUCO_META_MARKER_TRACKER_URL=n+"aruco-meta-marker-tracker.js",r.IMAGE_TEMPLATE_TRACKER_URL=n+"image-template-tracker.js"},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DedicatedWorker=void 0;var n=(a.createFromSources=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r="",n=0;n<e.length-1;n++)r+=e[n].toString();return r+="("+e[e.length-1].toString()+")();",new Worker(window.URL.createObjectURL(new Blob([r])))},a.createFromLocation=function(e,t,r){var n='Module = {\n            locateFile: function (path) {\n                return "'+e.replace(/.js$/,".wasm")+'";\n            },\n            onRuntimeInitialized: function () {\n                ('+t.toString()+")();\n            }\n        };",a="this.onmessage = "+r.toString()+";",i='function importJavascript() { importScripts("'+e+'"); }';return this.createFromSources(n,a,i)},a.unexpectedMessageHandler=function(e){throw Error("Unexpected message from WebWorker: "+e)},a);function a(){}r.DedicatedWorker=n},{}],12:[function(e,t,i){(function(a){(function(){"use strict";var n,e=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(i,"__esModule",{value:!0}),i.FilteredVector3=void 0;var o,s="undefined"!=typeof window?window.BABYLON:void 0!==a?a.BABYLON:null,t=(o=s.Vector3,e(r,o),r.prototype.addSample=function(e){this._sampleAverage.scaleInPlace(this._samples.length),this._sampleAverage.subtractInPlace(this._samples[this._idx]),this._samples[this._idx].copyFrom(e),this._sampleAverage.addInPlace(this._samples[this._idx]),this._sampleAverage.scaleInPlace(1/this._samples.length),this._idx=(this._idx+1)%this._samples.length;for(var t=0,r=0;r<this._samples.length;++r)this._sampleSquaredDistances[r]=s.Vector3.DistanceSquared(this._sampleAverage,this._samples[r]),t+=this._sampleSquaredDistances[r];t/=this._samples.length;var n=0;for(this.set(0,0,0),r=0;r<=this._samples.length;++r)this._sampleSquaredDistances[r]<=t&&(this.addInPlace(this._samples[r]),n+=1);this.scaleInPlace(1/n)},r);function r(e,t,r,n){void 0===n&&(n=1);var a=o.call(this,e,t,r)||this;a._idx=0,a._samples=[],a._sampleSquaredDistances=[];for(var i=0;i<n;++i)a._samples.push(new s.Vector3(e,t,r)),a._sampleSquaredDistances.push(0);return a._sampleAverage=new s.Vector3(e,t,r),a}i.FilteredVector3=t}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,t,s){(function(o){(function(){"use strict";var n,e=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(s,"__esModule",{value:!0}),s.TrackedNode=void 0;var a,i="undefined"!=typeof window?window.BABYLON:void 0!==o?o.BABYLON:null,t=(a=i.TransformNode,e(r,a),r.prototype.isTracking=function(){return this._isTracking},r.prototype.setTracking=function(e,t,r){this.position.copyFrom(e),this.rotationQuaternion?this.rotationQuaternion.copyFrom(t):this.rotationQuaternion=t.clone(),r?this._notTrackedFramesCount=0:(this._notTrackedFramesCount+=1,this._notTrackedFramesCount<5&&(r=!0)),!this._isTracking&&r?this.onTrackingAcquiredObservable.notifyObservers(this):this._isTracking&&!r&&this.onTrackingLostObservable.notifyObservers(this),this._isTracking=r,this.setEnabled(!this.disableWhenNotTracked||this._isTracking)},r);function r(e,t,r){void 0===r&&(r=!0);var n=a.call(this,e,t,!0)||this;return n._isTracking=!1,n.disableWhenNotTracked=r,n.disableWhenNotTracked&&n.setEnabled(!1),n._notTrackedFramesCount=10,n.onTrackingAcquiredObservable=new i.Observable(function(e){n._isTracking&&n.onTrackingAcquiredObservable.notifyObserver(e,n)}),n.onTrackingLostObservable=new i.Observable,n.rotationQuaternion=i.Quaternion.Identity(),n}s.TrackedNode=t}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3])(3)});
window.define = externalDefine;window.require = externalRequire;
